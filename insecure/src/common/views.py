from django.shortcuts import render
from django.db import connection
from django.utils.crypto import get_random_string
from datetime import datetime
# Create your views here.

cursor = connection.cursor()


def index(request):
    return render(request, 'common/index.html')


def about(request):
    return render(request, 'common/about.html')


def contactus(request):
    return render(request, 'common/contactus.html')


def ourdoctors(request):
    cursor.execute("SELECT * from common_users where role = 'doctor';")
    results = cursor.fetchall()
    return render(request, 'common/ourdoctors.html', {'results': results})


def enquiry(request):
    if request.method == 'POST':
        try:
            name = request.POST.get("name")
            email = request.POST.get("email")
            enquiry = request.POST.get("enquiry")
            current_time = datetime.now().strftime("%d/%m/%Y %H:%M:%S")
            requestid = get_random_string(20)
            query = "INSERT INTO enquiry(name,email,enquiry,datetime, enquiryid) VALUES ('" + str(name) + "','" + str(
                email) + "','" + str(enquiry) + "','" + str(current_time) + "','" + str(requestid) + "');"
            cursor.execute(query)
            connection.commit()
            successMessage = "Enquiry has been successfully recorded"
            return render(request, 'common/enquiry.html',
                          {'successMessage': successMessage})
        except Exception as e:
            errorMessage = "An error has occurred. Please contact the admin."
            return render(request, 'common/enquiry.html',
                          {'errorMessage': errorMessage})
    return render(request, 'common/enquiry.html')
